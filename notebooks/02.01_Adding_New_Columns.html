

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Adding New Columns &#8212; From Excel to Pandas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Adding Various Columns with Functions" href="02.02_more_excel_functions.html" />
    <link rel="prev" title="Reading Data from External API" href="01.03_loading_data_from_API.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">From Excel to Pandas</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Welcome to the tutorial “from-Excel-to-Pandas” for data analysis
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started.html">
   Install Locally
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started.html#open-in-binder-colab">
   Open in Binder/Colab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started.html#open-in-visual-studio-code">
   Open in Visual Studio Code
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Loading Data
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="01%20-%20loading%20files.html">
   Loading Files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01.02%20-%20loading%20data%20from%20HTML.html">
   Reading Data from Web Sites
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01.03_loading_data_from_API.html">
   Reading Data from External API
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Adding Columns
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Adding New Columns
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02.02_more_excel_functions.html">
   Adding Various Columns with Functions
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Table Aggregation and Reshaping
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="03.01_pivot_tables.html">
   Creating a Pivot Table
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03.02_group_by.html">
   Split a Table into Groups
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Table Enrichment with Merge
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="03.03_merge.html">
   Merge/Join Tables (VLOOKUP)
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Industries Use Cases
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="08.01_Logistics_analysis.html">
   Logistics Analysis
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/notebooks/02.01_Adding_New_Columns.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/notebooks/02.01_Adding_New_Columns.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/executablebooks/jupyter-book/blob/master/notebooks/02.01_Adding_New_Columns.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#constant-value">
   Constant Value
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#excel-functions-equivalent">
   Excel Functions Equivalent
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#more-textual-functions">
     More Textual Functions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-lambda">
   Using Lambda
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#multiple-data-sources">
   Multiple Data Sources
  </a>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="adding-new-columns">
<h1>Adding New Columns<a class="headerlink" href="#adding-new-columns" title="Permalink to this headline">¶</a></h1>
<p>In the second chapter we will learn how to add new columns to the tables based on a set of functions. This is similar to the Functions that are available in Excel with <em>=FUNC(A1)</em></p>
<p>We will start with loading a csv file that is hosted in data.world on the “Median Value Per Sq ft per zip code in the US”</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">us_median_sq_ft_value</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span>
    <span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://query.data.world/s/xrfy7fb7oq55gpzh6bvs6jtonv32lk&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">us_median_sq_ft_value</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>RegionID</th>
      <th>RegionName</th>
      <th>City</th>
      <th>State</th>
      <th>Metro</th>
      <th>CountyName</th>
      <th>SizeRank</th>
      <th>1996-04</th>
      <th>1996-05</th>
      <th>1996-06</th>
      <th>...</th>
      <th>2016-12</th>
      <th>2017-01</th>
      <th>2017-02</th>
      <th>2017-03</th>
      <th>2017-04</th>
      <th>2017-05</th>
      <th>2017-06</th>
      <th>2017-07</th>
      <th>2017-08</th>
      <th>2017-09</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>61639</td>
      <td>10025</td>
      <td>New York</td>
      <td>NY</td>
      <td>New York</td>
      <td>New York</td>
      <td>1</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>1306.0</td>
      <td>1290</td>
      <td>1277</td>
      <td>1272</td>
      <td>1271</td>
      <td>1277</td>
      <td>1281</td>
      <td>1279</td>
      <td>1274</td>
      <td>1270</td>
    </tr>
    <tr>
      <th>1</th>
      <td>84654</td>
      <td>60657</td>
      <td>Chicago</td>
      <td>IL</td>
      <td>Chicago</td>
      <td>Cook</td>
      <td>2</td>
      <td>134.0</td>
      <td>134.0</td>
      <td>133.0</td>
      <td>...</td>
      <td>291.0</td>
      <td>294</td>
      <td>296</td>
      <td>295</td>
      <td>293</td>
      <td>294</td>
      <td>294</td>
      <td>294</td>
      <td>294</td>
      <td>295</td>
    </tr>
    <tr>
      <th>2</th>
      <td>61637</td>
      <td>10023</td>
      <td>New York</td>
      <td>NY</td>
      <td>New York</td>
      <td>New York</td>
      <td>3</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>1602.0</td>
      <td>1597</td>
      <td>1580</td>
      <td>1567</td>
      <td>1569</td>
      <td>1570</td>
      <td>1560</td>
      <td>1543</td>
      <td>1529</td>
      <td>1521</td>
    </tr>
    <tr>
      <th>3</th>
      <td>84616</td>
      <td>60614</td>
      <td>Chicago</td>
      <td>IL</td>
      <td>Chicago</td>
      <td>Cook</td>
      <td>4</td>
      <td>149.0</td>
      <td>150.0</td>
      <td>150.0</td>
      <td>...</td>
      <td>330.0</td>
      <td>333</td>
      <td>333</td>
      <td>331</td>
      <td>330</td>
      <td>330</td>
      <td>329</td>
      <td>328</td>
      <td>329</td>
      <td>329</td>
    </tr>
    <tr>
      <th>4</th>
      <td>93144</td>
      <td>79936</td>
      <td>El Paso</td>
      <td>TX</td>
      <td>El Paso</td>
      <td>El Paso</td>
      <td>5</td>
      <td>50.0</td>
      <td>51.0</td>
      <td>50.0</td>
      <td>...</td>
      <td>81.0</td>
      <td>81</td>
      <td>81</td>
      <td>81</td>
      <td>81</td>
      <td>81</td>
      <td>82</td>
      <td>82</td>
      <td>82</td>
      <td>82</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 265 columns</p>
</div></div></div>
</div>
<div class="section" id="constant-value">
<h2>Constant Value<a class="headerlink" href="#constant-value" title="Permalink to this headline">¶</a></h2>
<p>The simplest way to add a column is to put a constant value. Since we know that this data is only for USA we can add a column with the value <em>USA</em> to a new column called <em>country</em>. We will be able to later merge this table with data from other countries and then this new column will be useful.</p>
<p>For setting a value in a column we will use the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.assign.html">assign</a> function of Pandas. You will need to scroll all the way to the right of the output to see the new <em>country</em> column.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">us_median_sq_ft_value</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">country</span><span class="o">=</span><span class="s2">&quot;USA&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>RegionID</th>
      <th>RegionName</th>
      <th>City</th>
      <th>State</th>
      <th>Metro</th>
      <th>CountyName</th>
      <th>SizeRank</th>
      <th>1996-04</th>
      <th>1996-05</th>
      <th>1996-06</th>
      <th>...</th>
      <th>2017-01</th>
      <th>2017-02</th>
      <th>2017-03</th>
      <th>2017-04</th>
      <th>2017-05</th>
      <th>2017-06</th>
      <th>2017-07</th>
      <th>2017-08</th>
      <th>2017-09</th>
      <th>country</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>61639</td>
      <td>10025</td>
      <td>New York</td>
      <td>NY</td>
      <td>New York</td>
      <td>New York</td>
      <td>1</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>1290</td>
      <td>1277</td>
      <td>1272</td>
      <td>1271</td>
      <td>1277</td>
      <td>1281</td>
      <td>1279</td>
      <td>1274</td>
      <td>1270</td>
      <td>USA</td>
    </tr>
    <tr>
      <th>1</th>
      <td>84654</td>
      <td>60657</td>
      <td>Chicago</td>
      <td>IL</td>
      <td>Chicago</td>
      <td>Cook</td>
      <td>2</td>
      <td>134.0</td>
      <td>134.0</td>
      <td>133.0</td>
      <td>...</td>
      <td>294</td>
      <td>296</td>
      <td>295</td>
      <td>293</td>
      <td>294</td>
      <td>294</td>
      <td>294</td>
      <td>294</td>
      <td>295</td>
      <td>USA</td>
    </tr>
    <tr>
      <th>2</th>
      <td>61637</td>
      <td>10023</td>
      <td>New York</td>
      <td>NY</td>
      <td>New York</td>
      <td>New York</td>
      <td>3</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>1597</td>
      <td>1580</td>
      <td>1567</td>
      <td>1569</td>
      <td>1570</td>
      <td>1560</td>
      <td>1543</td>
      <td>1529</td>
      <td>1521</td>
      <td>USA</td>
    </tr>
    <tr>
      <th>3</th>
      <td>84616</td>
      <td>60614</td>
      <td>Chicago</td>
      <td>IL</td>
      <td>Chicago</td>
      <td>Cook</td>
      <td>4</td>
      <td>149.0</td>
      <td>150.0</td>
      <td>150.0</td>
      <td>...</td>
      <td>333</td>
      <td>333</td>
      <td>331</td>
      <td>330</td>
      <td>330</td>
      <td>329</td>
      <td>328</td>
      <td>329</td>
      <td>329</td>
      <td>USA</td>
    </tr>
    <tr>
      <th>4</th>
      <td>93144</td>
      <td>79936</td>
      <td>El Paso</td>
      <td>TX</td>
      <td>El Paso</td>
      <td>El Paso</td>
      <td>5</td>
      <td>50.0</td>
      <td>51.0</td>
      <td>50.0</td>
      <td>...</td>
      <td>81</td>
      <td>81</td>
      <td>81</td>
      <td>81</td>
      <td>81</td>
      <td>82</td>
      <td>82</td>
      <td>82</td>
      <td>82</td>
      <td>USA</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>14750</th>
      <td>73940</td>
      <td>36564</td>
      <td>Fairhope</td>
      <td>AL</td>
      <td>Daphne</td>
      <td>Baldwin</td>
      <td>14751</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>230</td>
      <td>238</td>
      <td>243</td>
      <td>245</td>
      <td>244</td>
      <td>245</td>
      <td>246</td>
      <td>244</td>
      <td>240</td>
      <td>USA</td>
    </tr>
    <tr>
      <th>14751</th>
      <td>59107</td>
      <td>3293</td>
      <td>Woodstock</td>
      <td>NH</td>
      <td>Claremont</td>
      <td>Grafton</td>
      <td>14752</td>
      <td>58.0</td>
      <td>59.0</td>
      <td>61.0</td>
      <td>...</td>
      <td>129</td>
      <td>129</td>
      <td>128</td>
      <td>129</td>
      <td>130</td>
      <td>130</td>
      <td>130</td>
      <td>130</td>
      <td>131</td>
      <td>USA</td>
    </tr>
    <tr>
      <th>14752</th>
      <td>82396</td>
      <td>55713</td>
      <td>Buhl</td>
      <td>MN</td>
      <td>Duluth</td>
      <td>Saint Louis</td>
      <td>14753</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>72</td>
      <td>73</td>
      <td>74</td>
      <td>74</td>
      <td>73</td>
      <td>73</td>
      <td>74</td>
      <td>77</td>
      <td>79</td>
      <td>USA</td>
    </tr>
    <tr>
      <th>14753</th>
      <td>66881</td>
      <td>21405</td>
      <td>Annapolis</td>
      <td>MD</td>
      <td>Baltimore</td>
      <td>Anne Arundel</td>
      <td>14754</td>
      <td>146.0</td>
      <td>149.0</td>
      <td>151.0</td>
      <td>...</td>
      <td>470</td>
      <td>462</td>
      <td>457</td>
      <td>457</td>
      <td>455</td>
      <td>454</td>
      <td>455</td>
      <td>458</td>
      <td>460</td>
      <td>USA</td>
    </tr>
    <tr>
      <th>14754</th>
      <td>94815</td>
      <td>85220</td>
      <td>Apache Junction</td>
      <td>AZ</td>
      <td>Phoenix</td>
      <td>Pinal</td>
      <td>14755</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>117</td>
      <td>119</td>
      <td>119</td>
      <td>119</td>
      <td>120</td>
      <td>121</td>
      <td>122</td>
      <td>124</td>
      <td>124</td>
      <td>USA</td>
    </tr>
  </tbody>
</table>
<p>14755 rows × 266 columns</p>
</div></div></div>
</div>
</div>
<div class="section" id="excel-functions-equivalent">
<h2>Excel Functions Equivalent<a class="headerlink" href="#excel-functions-equivalent" title="Permalink to this headline">¶</a></h2>
<p>Most of the functions that you are used to use in Excel have a direct Equivalent in Pands. We will try a few of them in the following examples. We will only look at the <em>City</em> column in the dataset.</p>
<p>For example: <code class="docutils literal notranslate"><span class="pre">=TRIM('cell</span> <span class="pre">for</span> <span class="pre">trimming')</span></code> can be replaced by <em>strip</em>.
We will:</p>
<ul class="simple">
<li><p>Take only the <em>City</em> column from the table</p></li>
<li><p>Add a column that strips spaces from around the string (<em>str</em>) of the <em>City</em> column</p></li>
<li><p>Show the head (first 5 lines) of the new sub-table</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">us_median_sq_ft_value</span><span class="p">[[</span><span class="s1">&#39;City&#39;</span><span class="p">]]</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">trimmed</span> <span class="o">=</span> <span class="n">us_median_sq_ft_value</span><span class="o">.</span><span class="n">City</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>City</th>
      <th>trimmed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>New York</td>
      <td>New York</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Chicago</td>
      <td>Chicago</td>
    </tr>
    <tr>
      <th>2</th>
      <td>New York</td>
      <td>New York</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Chicago</td>
      <td>Chicago</td>
    </tr>
    <tr>
      <th>4</th>
      <td>El Paso</td>
      <td>El Paso</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>or to remove spaces between words, you will need to run ‘Find and Replace’ option in Excel and in Pandas we can use the <em>replace</em> function:</p>
<ul class="simple">
<li><p>Take only the <em>City</em> column from the table</p></li>
<li><p>Add a column that is removes every space (‘ ‘) from the string of the <em>City</em> column</p></li>
<li><p>Show the head of the new sub-table</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">us_median_sq_ft_value</span><span class="p">[[</span><span class="s1">&#39;City&#39;</span><span class="p">]]</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">no_space</span> <span class="o">=</span> <span class="n">us_median_sq_ft_value</span><span class="o">.</span><span class="n">City</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
    <span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>City</th>
      <th>no_space</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>New York</td>
      <td>NewYork</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Chicago</td>
      <td>Chicago</td>
    </tr>
    <tr>
      <th>2</th>
      <td>New York</td>
      <td>NewYork</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Chicago</td>
      <td>Chicago</td>
    </tr>
    <tr>
      <th>4</th>
      <td>El Paso</td>
      <td>ElPaso</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="section" id="more-textual-functions">
<h3>More Textual Functions<a class="headerlink" href="#more-textual-functions" title="Permalink to this headline">¶</a></h3>
<p>Another commonly used Excel functions are LEFT and RIGHT (<code class="docutils literal notranslate"><span class="pre">=LEFT(Cell,</span> <span class="pre">number</span> <span class="pre">of</span> <span class="pre">digits)</span></code>). In Pandas, we can use the ‘<code class="docutils literal notranslate"><span class="pre">:</span></code>’, which is used for <em>until</em> or <em>from</em>:</p>
<ul class="simple">
<li><p>Take only the <em>City</em> column from the table</p></li>
<li><p>Add a column that takes the first 5 characters (=LEFT) from the string of the <em>City</em> column</p></li>
<li><p>Add a column that takes the last 5 characters (=RIGHT) from the string of the <em>City</em> column</p></li>
<li><p>Show the head of the new sub-table</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">us_median_sq_ft_value</span><span class="p">[[</span><span class="s1">&#39;City&#39;</span><span class="p">]]</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">city_left</span> <span class="o">=</span> <span class="n">us_median_sq_ft_value</span><span class="o">.</span><span class="n">City</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span> <span class="c1"># until the 5th character</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">city_right</span> <span class="o">=</span> <span class="n">us_median_sq_ft_value</span><span class="o">.</span><span class="n">City</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:])</span> <span class="c1"># from the 5th characters from the end (=right)</span>
    <span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>City</th>
      <th>city_left</th>
      <th>city_right</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>New York</td>
      <td>New Y</td>
      <td>York</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Chicago</td>
      <td>Chica</td>
      <td>icago</td>
    </tr>
    <tr>
      <th>2</th>
      <td>New York</td>
      <td>New Y</td>
      <td>York</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Chicago</td>
      <td>Chica</td>
      <td>icago</td>
    </tr>
    <tr>
      <th>4</th>
      <td>El Paso</td>
      <td>El Pa</td>
      <td>Paso</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="using-lambda">
<h2>Using Lambda<a class="headerlink" href="#using-lambda" title="Permalink to this headline">¶</a></h2>
<p>Lambda is a bit confusing at first glance, however, it is used to define a the function that we want to apply on a each row or columns of the table. For example, let’s define two new columns: one that is calculating the quantile of the region compare to all the regions, and one that is checking if the state is one of [‘NY’,’NJ’]</p>
<p>We will focus only on the <em>State</em> and the last month in the data and add the two new columns to it.</p>
<ul class="simple">
<li><p>Take only the <em>State</em> and the values of the last period columns from the table</p></li>
<li><p>Add a column that checks if the <em>State</em> is either <em>‘NY’</em> or <em>‘NJ’</em></p></li>
<li><p>Add a column that calculates the ratio of the average price of the row to the maximum price (quantile)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">us_median_sq_ft_value</span><span class="p">[[</span><span class="s1">&#39;State&#39;</span><span class="p">,</span><span class="s1">&#39;2017-09&#39;</span><span class="p">]]</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">is_NY_or_NJ</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;NY&#39;</span><span class="p">,</span><span class="s1">&#39;NJ&#39;</span><span class="p">]))</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">last_quantile</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;2017-09&#39;</span><span class="p">]</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;2017-09&#39;</span><span class="p">]))</span>    
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>State</th>
      <th>2017-09</th>
      <th>is_NY_or_NJ</th>
      <th>last_quantile</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>NY</td>
      <td>1270</td>
      <td>True</td>
      <td>0.702434</td>
    </tr>
    <tr>
      <th>1</th>
      <td>IL</td>
      <td>295</td>
      <td>False</td>
      <td>0.163164</td>
    </tr>
    <tr>
      <th>2</th>
      <td>NY</td>
      <td>1521</td>
      <td>True</td>
      <td>0.841261</td>
    </tr>
    <tr>
      <th>3</th>
      <td>IL</td>
      <td>329</td>
      <td>False</td>
      <td>0.181969</td>
    </tr>
    <tr>
      <th>4</th>
      <td>TX</td>
      <td>82</td>
      <td>False</td>
      <td>0.045354</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>14750</th>
      <td>AL</td>
      <td>240</td>
      <td>False</td>
      <td>0.132743</td>
    </tr>
    <tr>
      <th>14751</th>
      <td>NH</td>
      <td>131</td>
      <td>False</td>
      <td>0.072456</td>
    </tr>
    <tr>
      <th>14752</th>
      <td>MN</td>
      <td>79</td>
      <td>False</td>
      <td>0.043695</td>
    </tr>
    <tr>
      <th>14753</th>
      <td>MD</td>
      <td>460</td>
      <td>False</td>
      <td>0.254425</td>
    </tr>
    <tr>
      <th>14754</th>
      <td>AZ</td>
      <td>124</td>
      <td>False</td>
      <td>0.068584</td>
    </tr>
  </tbody>
</table>
<p>14755 rows × 4 columns</p>
</div></div></div>
</div>
</div>
<div class="section" id="multiple-data-sources">
<h2>Multiple Data Sources<a class="headerlink" href="#multiple-data-sources" title="Permalink to this headline">¶</a></h2>
<p>We can do a more complicated analysis that is based on additional external sources. For example, we want to calculate the differences between red states and blue states. We can then ask various questions regarding the impacts or correlation between the house prices and the election results and voting patterns.</p>
<p>First we will load data regarding the voting in various states across the years. A quick internet search finds an interesting table in the following Wikipedia page. Since there are multiple tables on that page, we can filter them using the <em>match</em> option, and using the word <em>Year</em> as the filter.</p>
<ul class="simple">
<li><p>Read the HTML tables in the wikipedia entry on the topic of red and blue states</p></li>
<li><p>retrive on the ones that have the word ‘Year’</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">red_blue_states_wikipedia_entry</span> <span class="o">=</span> <span class="s1">&#39;https://en.wikipedia.org/wiki/Red_states_and_blue_states&#39;</span>
<span class="n">wikipedia_page_tables</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span>
    <span class="o">.</span><span class="n">read_html</span><span class="p">(</span>
        <span class="n">red_blue_states_wikipedia_entry</span><span class="p">,</span> 
        <span class="n">match</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>As we saw in the loading data from web site, the list can includes multiple tables. However, we filtered it and only have one table, and we can access it with the <em>[0]</em> modifier.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">red_blue_states</span> <span class="o">=</span> <span class="n">wikipedia_page_tables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">red_blue_states</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>Year</th>
      <th>1972</th>
      <th>1976</th>
      <th>1980</th>
      <th>1984</th>
      <th>1988</th>
      <th>1992</th>
      <th>1996</th>
      <th>2000</th>
      <th>2004</th>
      <th>2008</th>
      <th>2012</th>
      <th>2016</th>
      <th>2020</th>
    </tr>
    <tr>
      <th></th>
      <th>Democratic Republican (lighter shading indicates win ≤5%)  Winner did not receive a majority of the popular vote  Winner did not receive a majority of the popular vote and lost the popular vote  Winner chosen by the House of Representatives  Electoral votes invalidated</th>
      <th>Democratic Republican (lighter shading indicates win ≤5%)  Winner did not receive a majority of the popular vote  Winner did not receive a majority of the popular vote and lost the popular vote  Winner chosen by the House of Representatives  Electoral votes invalidated</th>
      <th>Democratic Republican (lighter shading indicates win ≤5%)  Winner did not receive a majority of the popular vote  Winner did not receive a majority of the popular vote and lost the popular vote  Winner chosen by the House of Representatives  Electoral votes invalidated</th>
      <th>Democratic Republican (lighter shading indicates win ≤5%)  Winner did not receive a majority of the popular vote  Winner did not receive a majority of the popular vote and lost the popular vote  Winner chosen by the House of Representatives  Electoral votes invalidated</th>
      <th>Democratic Republican (lighter shading indicates win ≤5%)  Winner did not receive a majority of the popular vote  Winner did not receive a majority of the popular vote and lost the popular vote  Winner chosen by the House of Representatives  Electoral votes invalidated</th>
      <th>Democratic Republican (lighter shading indicates win ≤5%)  Winner did not receive a majority of the popular vote  Winner did not receive a majority of the popular vote and lost the popular vote  Winner chosen by the House of Representatives  Electoral votes invalidated</th>
      <th>Democratic Republican (lighter shading indicates win ≤5%)  Winner did not receive a majority of the popular vote  Winner did not receive a majority of the popular vote and lost the popular vote  Winner chosen by the House of Representatives  Electoral votes invalidated</th>
      <th>Democratic Republican (lighter shading indicates win ≤5%)  Winner did not receive a majority of the popular vote  Winner did not receive a majority of the popular vote and lost the popular vote  Winner chosen by the House of Representatives  Electoral votes invalidated</th>
      <th>Democratic Republican (lighter shading indicates win ≤5%)  Winner did not receive a majority of the popular vote  Winner did not receive a majority of the popular vote and lost the popular vote  Winner chosen by the House of Representatives  Electoral votes invalidated</th>
      <th>Democratic Republican (lighter shading indicates win ≤5%)  Winner did not receive a majority of the popular vote  Winner did not receive a majority of the popular vote and lost the popular vote  Winner chosen by the House of Representatives  Electoral votes invalidated</th>
      <th>Democratic Republican (lighter shading indicates win ≤5%)  Winner did not receive a majority of the popular vote  Winner did not receive a majority of the popular vote and lost the popular vote  Winner chosen by the House of Representatives  Electoral votes invalidated</th>
      <th>Democratic Republican (lighter shading indicates win ≤5%)  Winner did not receive a majority of the popular vote  Winner did not receive a majority of the popular vote and lost the popular vote  Winner chosen by the House of Representatives  Electoral votes invalidated</th>
      <th>Democratic Republican (lighter shading indicates win ≤5%)  Winner did not receive a majority of the popular vote  Winner did not receive a majority of the popular vote and lost the popular vote  Winner chosen by the House of Representatives  Electoral votes invalidated</th>
      <th>Democratic Republican (lighter shading indicates win ≤5%)  Winner did not receive a majority of the popular vote  Winner did not receive a majority of the popular vote and lost the popular vote  Winner chosen by the House of Representatives  Electoral votes invalidated</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Democratic candidate</td>
      <td>George McGovern</td>
      <td>Jimmy Carter</td>
      <td>Jimmy Carter</td>
      <td>Walter Mondale</td>
      <td>Michael Dukakis</td>
      <td>Bill Clinton</td>
      <td>Bill Clinton</td>
      <td>Al Gore</td>
      <td>John Kerry</td>
      <td>Barack Obama</td>
      <td>Barack Obama</td>
      <td>Hillary Clinton</td>
      <td>Joe Biden</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Republican candidate</td>
      <td>Richard Nixon</td>
      <td>Gerald Ford</td>
      <td>Ronald Reagan</td>
      <td>Ronald Reagan</td>
      <td>George H. W. Bush</td>
      <td>George H. W. Bush</td>
      <td>Bob Dole</td>
      <td>George W. Bush</td>
      <td>George W. Bush</td>
      <td>John McCain</td>
      <td>Mitt Romney</td>
      <td>Donald Trump</td>
      <td>Donald Trump</td>
    </tr>
    <tr>
      <th>2</th>
      <td>National popular vote</td>
      <td>Nixon</td>
      <td>Carter</td>
      <td>Reagan</td>
      <td>Reagan</td>
      <td>Bush</td>
      <td>Clinton</td>
      <td>Clinton</td>
      <td>Gore</td>
      <td>Bush</td>
      <td>Obama</td>
      <td>Obama</td>
      <td>Clinton</td>
      <td>Biden</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Alabama</td>
      <td>Nixon</td>
      <td>Carter</td>
      <td>Reagan</td>
      <td>Reagan</td>
      <td>Bush</td>
      <td>Bush</td>
      <td>Dole</td>
      <td>Bush</td>
      <td>Bush</td>
      <td>McCain</td>
      <td>Romney</td>
      <td>Trump</td>
      <td>Trump</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Alaska</td>
      <td>Nixon</td>
      <td>Ford</td>
      <td>Reagan</td>
      <td>Reagan</td>
      <td>Bush</td>
      <td>Bush</td>
      <td>Dole</td>
      <td>Bush</td>
      <td>Bush</td>
      <td>McCain</td>
      <td>Romney</td>
      <td>Trump</td>
      <td>Trump</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We will start with creating a new list of states that voted for a specific candidate in a specific electio. First, let’s use Trump in the 2016 elections.</p>
<p>We are using here a few new functions such as <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.rename.html">rename</a>, <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.query.html">query</a> and <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.iloc.html">iloc</a>, which we will discuss in more details in the next sections.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">red_candidate</span> <span class="o">=</span> <span class="s1">&#39;Trump&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>We will:</p>
<ul class="simple">
<li><p>Take the large table of the multiple elections results</p></li>
<li><p>Remove the complicated multi level header from the table (<em>droplevel</em>)</p></li>
<li><p>Filter to only states that have the name of the red candidate, we defined above, in the column of the election year (<em>2020</em>, for example). Note, we need to surround the name of the column with ` as it starts with a number</p></li>
<li><p>Take only the first column from the result table, which holds the name of the state (<em>iloc[:,0]</em>).</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">red_states_2020</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">red_blue_states</span>
    <span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
    <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;`2020` == @red_candidate&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">red_states_2020</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3            Alabama
4             Alaska
6           Arkansas
12           Florida
15             Idaho
17           Indiana
18              Iowa
19            Kansas
20          Kentucky
21         Louisiana
29       Mississippi
30          Missouri
31           Montana
39    North Carolina
40      North Dakota
41              Ohio
42          Oklahoma
46    South Carolina
47      South Dakota
48         Tennessee
49             Texas
50              Utah
54     West Virginia
56           Wyoming
Name: Year, dtype: object
</pre></div>
</div>
</div>
</div>
<p>Now that we have the list of the red states of 2020, we need to match them to the states that we have in our house prices data set. We see that we have to match the short version in the data set with the long version in the red state list.</p>
<p>We will use a another option to create a data frame using a Dictionary. It is not hard to find a list of mapping of states names and abbreviations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">us_state_abbrev</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Alabama&#39;</span><span class="p">:</span> <span class="s1">&#39;AL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Alaska&#39;</span><span class="p">:</span> <span class="s1">&#39;AK&#39;</span><span class="p">,</span>
    <span class="s1">&#39;American Samoa&#39;</span><span class="p">:</span> <span class="s1">&#39;AS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Arizona&#39;</span><span class="p">:</span> <span class="s1">&#39;AZ&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Arkansas&#39;</span><span class="p">:</span> <span class="s1">&#39;AR&#39;</span><span class="p">,</span>
    <span class="s1">&#39;California&#39;</span><span class="p">:</span> <span class="s1">&#39;CA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Colorado&#39;</span><span class="p">:</span> <span class="s1">&#39;CO&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Connecticut&#39;</span><span class="p">:</span> <span class="s1">&#39;CT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Delaware&#39;</span><span class="p">:</span> <span class="s1">&#39;DE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;District of Columbia&#39;</span><span class="p">:</span> <span class="s1">&#39;DC&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Florida&#39;</span><span class="p">:</span> <span class="s1">&#39;FL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Georgia&#39;</span><span class="p">:</span> <span class="s1">&#39;GA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Guam&#39;</span><span class="p">:</span> <span class="s1">&#39;GU&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Hawaii&#39;</span><span class="p">:</span> <span class="s1">&#39;HI&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Idaho&#39;</span><span class="p">:</span> <span class="s1">&#39;ID&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Illinois&#39;</span><span class="p">:</span> <span class="s1">&#39;IL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Indiana&#39;</span><span class="p">:</span> <span class="s1">&#39;IN&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Iowa&#39;</span><span class="p">:</span> <span class="s1">&#39;IA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Kansas&#39;</span><span class="p">:</span> <span class="s1">&#39;KS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Kentucky&#39;</span><span class="p">:</span> <span class="s1">&#39;KY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Louisiana&#39;</span><span class="p">:</span> <span class="s1">&#39;LA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Maine&#39;</span><span class="p">:</span> <span class="s1">&#39;ME&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Maryland&#39;</span><span class="p">:</span> <span class="s1">&#39;MD&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Massachusetts&#39;</span><span class="p">:</span> <span class="s1">&#39;MA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Michigan&#39;</span><span class="p">:</span> <span class="s1">&#39;MI&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Minnesota&#39;</span><span class="p">:</span> <span class="s1">&#39;MN&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Mississippi&#39;</span><span class="p">:</span> <span class="s1">&#39;MS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Missouri&#39;</span><span class="p">:</span> <span class="s1">&#39;MO&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Montana&#39;</span><span class="p">:</span> <span class="s1">&#39;MT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Nebraska&#39;</span><span class="p">:</span> <span class="s1">&#39;NE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Nevada&#39;</span><span class="p">:</span> <span class="s1">&#39;NV&#39;</span><span class="p">,</span>
    <span class="s1">&#39;New Hampshire&#39;</span><span class="p">:</span> <span class="s1">&#39;NH&#39;</span><span class="p">,</span>
    <span class="s1">&#39;New Jersey&#39;</span><span class="p">:</span> <span class="s1">&#39;NJ&#39;</span><span class="p">,</span>
    <span class="s1">&#39;New Mexico&#39;</span><span class="p">:</span> <span class="s1">&#39;NM&#39;</span><span class="p">,</span>
    <span class="s1">&#39;New York&#39;</span><span class="p">:</span> <span class="s1">&#39;NY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;North Carolina&#39;</span><span class="p">:</span> <span class="s1">&#39;NC&#39;</span><span class="p">,</span>
    <span class="s1">&#39;North Dakota&#39;</span><span class="p">:</span> <span class="s1">&#39;ND&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Northern Mariana Islands&#39;</span><span class="p">:</span><span class="s1">&#39;MP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Ohio&#39;</span><span class="p">:</span> <span class="s1">&#39;OH&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Oklahoma&#39;</span><span class="p">:</span> <span class="s1">&#39;OK&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Oregon&#39;</span><span class="p">:</span> <span class="s1">&#39;OR&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Pennsylvania&#39;</span><span class="p">:</span> <span class="s1">&#39;PA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Puerto Rico&#39;</span><span class="p">:</span> <span class="s1">&#39;PR&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Rhode Island&#39;</span><span class="p">:</span> <span class="s1">&#39;RI&#39;</span><span class="p">,</span>
    <span class="s1">&#39;South Carolina&#39;</span><span class="p">:</span> <span class="s1">&#39;SC&#39;</span><span class="p">,</span>
    <span class="s1">&#39;South Dakota&#39;</span><span class="p">:</span> <span class="s1">&#39;SD&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tennessee&#39;</span><span class="p">:</span> <span class="s1">&#39;TN&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Texas&#39;</span><span class="p">:</span> <span class="s1">&#39;TX&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Utah&#39;</span><span class="p">:</span> <span class="s1">&#39;UT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Vermont&#39;</span><span class="p">:</span> <span class="s1">&#39;VT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Virgin Islands&#39;</span><span class="p">:</span> <span class="s1">&#39;VI&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Virginia&#39;</span><span class="p">:</span> <span class="s1">&#39;VA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Washington&#39;</span><span class="p">:</span> <span class="s1">&#39;WA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;West Virginia&#39;</span><span class="p">:</span> <span class="s1">&#39;WV&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Wisconsin&#39;</span><span class="p">:</span> <span class="s1">&#39;WI&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Wyoming&#39;</span><span class="p">:</span> <span class="s1">&#39;WY&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>and we can use the dictionary to create a table (DataFrame) from it:</p>
<ul class="simple">
<li><p>Create a new dataframe table</p></li>
<li><p>Using the dictionary of the us state abbreviation above</p></li>
<li><p>with row for each entry</p></li>
<li><p>and name the column of the value ‘Abbreviation’</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">us_state_abbrev_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span>
    <span class="o">.</span><span class="n">DataFrame</span>
    <span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">us_state_abbrev</span><span class="p">,</span> 
                <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span>
                <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Abbreviation&#39;</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Before we continue, we can keep this table as file to be used in future analyses. We could also create this file in Excel and load it as we will do in the future with this file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">us_state_abbrev_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;../data/us_state_abbrev.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we will:</p>
<ul class="simple">
<li><p>Start with the abbreviation list of all the US states</p></li>
<li><p>Take only the ones that also appear in the list of red states in the 2020 election</p></li>
<li><p>Take all the rows left, and the index column (country name) with the abbreviation column</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">red_state_abbrev</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">us_state_abbrev_df</span>
    <span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">red_states_2020</span><span class="p">]</span>
    <span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Abbreviation&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">red_state_abbrev</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Alabama           AL
Alaska            AK
Arkansas          AR
Florida           FL
Idaho             ID
Indiana           IN
Iowa              IA
Kansas            KS
Kentucky          KY
Louisiana         LA
Mississippi       MS
Missouri          MO
Montana           MT
North Carolina    NC
North Dakota      ND
Ohio              OH
Oklahoma          OK
South Carolina    SC
South Dakota      SD
Tennessee         TN
Texas             TX
Utah              UT
West Virginia     WV
Wyoming           WY
Name: Abbreviation, dtype: object
</pre></div>
</div>
</div>
</div>
<p>Finally:</p>
<ul class="simple">
<li><p>Start with the table of the median value of sqr feet per zip code</p></li>
<li><p>Add a new column (<em>is_red</em>) that checks if the <em>State</em> in each row is in the list of red states that we calculated above.</p></li>
<li><p>Create two groups for red and blue states and the a value in the last period in the table (September 2017)</p></li>
<li><p>Calculate the average (<em>mean</em>) price for each of the two groups</p></li>
<li><p>Plot the two values</p></li>
<li><p>Title the graph with “Average square feet value between blue and red states”</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">us_median_sq_ft_value</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">is_red</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">red_state_abbrev</span><span class="p">))</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;is_red&#39;</span><span class="p">)[</span><span class="s1">&#39;2017-09&#39;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="o">.</span><span class="n">plot</span>
    <span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Average square feet value between blue and red states&quot;</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02.01_Adding_New_Columns_32_0.png" src="../_images/02.01_Adding_New_Columns_32_0.png" />
</div>
</div>
<p>We can now see that the average value of square feet in the blue states (<em>is_red = False</em>) is about twice the average of red states (<em>is_red = True</em>)</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="01.03_loading_data_from_API.html" title="previous page">Reading Data from External API</a>
    <a class='right-next' id="next-link" href="02.02_more_excel_functions.html" title="next page">Adding Various Columns with Functions</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The Aiola Team<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
  </body>
</html>