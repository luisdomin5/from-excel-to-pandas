

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reading Data from External API &#8212; From Excel to Pandas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Adding New Columns" href="02.01_Adding_New_Columns.html" />
    <link rel="prev" title="Reading Data from Web Sites" href="01.02%20-%20loading%20data%20from%20HTML.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">From Excel to Pandas</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Welcome to the tutorial “from-Excel-to-Pandas” for data analysis
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started.html">
   Install Locally
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started.html#open-in-binder-colab">
   Open in Binder/Colab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started.html#open-in-visual-studio-code">
   Open in Visual Studio Code
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Loading Data
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="01%20-%20loading%20files.html">
   Loading Files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01.02%20-%20loading%20data%20from%20HTML.html">
   Reading Data from Web Sites
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Reading Data from External API
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Adding Columns
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="02.01_Adding_New_Columns.html">
   Adding New Columns
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02.02_date_functions.html">
   Date Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02.02_date_functions.html#real-life-example">
   Real life example
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Table Aggregation and Reshaping
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="03.01_pivot_tables.html">
   Creating a Pivot Table
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03.02_group_by.html">
   Split a Table into Groups
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Table Enrichment with Merge
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="03.03_merge.html">
   Merge/Join Tables (VLOOKUP)
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Industries Use Cases
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="08.01_Logistics_analysis.html">
   Logistics Analysis
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/notebooks/01.03_loading_data_from_API.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/notebooks/01.03_loading_data_from_API.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/executablebooks/jupyter-book/blob/master/notebooks/01.03_loading_data_from_API.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#loading-api-data">
   Loading API data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#loading-from-simple-api">
   Loading from simple API
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simple-data-visualization">
   Simple Data Visualization
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#loading-the-page-views-of-all-nasdaq-100">
   Loading the page views of all NASDAQ 100
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#loading-from-complex-api">
   Loading from complex API
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#extracting-the-relevant-data">
   Extracting the relevant data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#quick-visualization">
   Quick Visualization
  </a>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="reading-data-from-external-api">
<h1>Reading Data from External API<a class="headerlink" href="#reading-data-from-external-api" title="Permalink to this headline">¶</a></h1>
<p>Often you want to add external data to your analysis. External data can be retrieved from API (Application Programable Interface) that is provided by various services such as CRM (Customer Relationship Management) systems. You can import HTML directly into Excel using <em>“Import”</em>.</p>
<p>In this notebook, we will learn how to use pandas <em>from_dict</em> to load data from these external API</p>
<div class="section" id="loading-api-data">
<h2>Loading API data<a class="headerlink" href="#loading-api-data" title="Permalink to this headline">¶</a></h2>
<p>We will load a few tables from simple API as well as complex ones</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="loading-from-simple-api">
<h2>Loading from simple API<a class="headerlink" href="#loading-from-simple-api" title="Permalink to this headline">¶</a></h2>
<p>If you have a simple API with no authentication, you can pass the URL of the requests library that we used in our previous toturial for loading HTML</p>
<p>For this excercise we will use the API of the Wikipedia page views. We will use it to test the idea that people who are thinking to buy stocks, are going to the wikipedia page of that stock, and therefore, if we see an increase in the views of a page, we will see an increase in the price of that share.</p>
<p>We will check the format of the API call from the <a class="reference external" href="https://www.mediawiki.org/wiki/API:Tutorial">technical page</a>. We see the we need to plug the name of stock ticker, and we will use the f-string syntax that is replacing the {page} (or any other variable in curly brackets) with the value of the variable (for example, <em>AMZN</em>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">page</span> <span class="o">=</span> <span class="s1">&#39;AMZN&#39;</span>

<span class="n">page_views_api_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;https://wikimedia.org/api/rest_v1/metrics/pageviews/per-article/en.wikipedia/all-access/all-agents/</span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s1">/daily/2020030100/2020033000&#39;</span>

<span class="kn">import</span> <span class="nn">requests</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">page_views_api_url</span><span class="p">)</span>
<span class="n">response</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Response [200]&gt;
</pre></div>
</div>
</div>
</div>
<p>We can use two methods to extract the data that we want from the JSON format. The first is using <em>json_normalize</em> and the second is using <em>from_dict</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span>
    <span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span>
        <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">(),</span> 
        <span class="s1">&#39;items&#39;</span>
        <span class="p">)</span>
<span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>project</th>
      <th>article</th>
      <th>granularity</th>
      <th>timestamp</th>
      <th>access</th>
      <th>agent</th>
      <th>views</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>en.wikipedia</td>
      <td>AMZN</td>
      <td>daily</td>
      <td>2020030100</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>en.wikipedia</td>
      <td>AMZN</td>
      <td>daily</td>
      <td>2020030200</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>en.wikipedia</td>
      <td>AMZN</td>
      <td>daily</td>
      <td>2020030300</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>16</td>
    </tr>
    <tr>
      <th>3</th>
      <td>en.wikipedia</td>
      <td>AMZN</td>
      <td>daily</td>
      <td>2020030400</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>en.wikipedia</td>
      <td>AMZN</td>
      <td>daily</td>
      <td>2020030500</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">page_view_data</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">requests</span>
    <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">page_views_api_url</span><span class="p">)</span>
    <span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;items&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">page_views_table</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span>
    <span class="o">.</span><span class="n">DataFrame</span>
    <span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">page_view_data</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">page_views_table</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>project</th>
      <th>article</th>
      <th>granularity</th>
      <th>timestamp</th>
      <th>access</th>
      <th>agent</th>
      <th>views</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>en.wikipedia</td>
      <td>AMZN</td>
      <td>daily</td>
      <td>2020030100</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>en.wikipedia</td>
      <td>AMZN</td>
      <td>daily</td>
      <td>2020030200</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>en.wikipedia</td>
      <td>AMZN</td>
      <td>daily</td>
      <td>2020030300</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>16</td>
    </tr>
    <tr>
      <th>3</th>
      <td>en.wikipedia</td>
      <td>AMZN</td>
      <td>daily</td>
      <td>2020030400</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>en.wikipedia</td>
      <td>AMZN</td>
      <td>daily</td>
      <td>2020030500</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="simple-data-visualization">
<h2>Simple Data Visualization<a class="headerlink" href="#simple-data-visualization" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Start with the page view table from the previous API call</p></li>
<li><p>Convert the timestamp column to date time format using the <em>%Y%m%d%H</em> format</p></li>
<li><p>Extract the day of the month from the above timestamp</p></li>
<li><p>Plot the results</p></li>
<li><p>as bar chart with the day of the month as x and the number of views as y</p></li>
<li><p>and title the graph as ‘Page views for …’ with the name of the page</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">page_views_table</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">timestamp</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">))</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">day</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
    <span class="o">.</span><span class="n">plot</span>
    <span class="o">.</span><span class="n">bar</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;views&#39;</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Page views for </span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/01.03_loading_data_from_API_10_0.png" src="../_images/01.03_loading_data_from_API_10_0.png" />
</div>
</div>
</div>
<div class="section" id="loading-the-page-views-of-all-nasdaq-100">
<h2>Loading the page views of all NASDAQ 100<a class="headerlink" href="#loading-the-page-views-of-all-nasdaq-100" title="Permalink to this headline">¶</a></h2>
<p>We saw in the previous section how to load the values of a table from Wikipeia (or other HTML pages). Let’s use it now to load all the NASDAQ 100 index companies to compare their page views.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nasdaq_100_wikipedia_entry</span> <span class="o">=</span> <span class="s1">&#39;https://en.wikipedia.org/wiki/NASDAQ-100&#39;</span>
<span class="n">nasdaq_100_tickers</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span>
    <span class="o">.</span><span class="n">read_html</span><span class="p">(</span>
        <span class="n">nasdaq_100_wikipedia_entry</span><span class="p">,</span> 
        <span class="n">match</span><span class="o">=</span><span class="s1">&#39;Ticker&#39;</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nasdaq_100_tickers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Company</th>
      <th>Ticker</th>
      <th>GICS Sector</th>
      <th>GICS Sub-Industry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Activision Blizzard</td>
      <td>ATVI</td>
      <td>Communication Services</td>
      <td>Interactive Home Entertainment</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Adobe Inc.</td>
      <td>ADBE</td>
      <td>Information Technology</td>
      <td>Application Software</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Advanced Micro Devices</td>
      <td>AMD</td>
      <td>Information Technology</td>
      <td>Semiconductors</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Alexion Pharmaceuticals</td>
      <td>ALXN</td>
      <td>Health Care</td>
      <td>Pharmaceuticals</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Align Technology</td>
      <td>ALGN</td>
      <td>Health Care</td>
      <td>Health Care Supplies</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>97</th>
      <td>Walgreen Boots Alliance, Inc.</td>
      <td>WBA</td>
      <td>Consumer Staples</td>
      <td>Drug Retail</td>
    </tr>
    <tr>
      <th>98</th>
      <td>Workday, Inc.</td>
      <td>WDAY</td>
      <td>Information Technology</td>
      <td>Application Software</td>
    </tr>
    <tr>
      <th>99</th>
      <td>Xcel Energy Inc.</td>
      <td>XEL</td>
      <td>Utilities</td>
      <td>Multi-Utilities</td>
    </tr>
    <tr>
      <th>100</th>
      <td>Xilinx, Inc.</td>
      <td>XLNX</td>
      <td>Information Technology</td>
      <td>Semiconductors</td>
    </tr>
    <tr>
      <th>101</th>
      <td>Zoom Video Communications</td>
      <td>ZM</td>
      <td>Information Technology</td>
      <td>Application Software</td>
    </tr>
  </tbody>
</table>
<p>102 rows × 4 columns</p>
</div></div></div>
</div>
<p>Now we want to get all the views of each company on our list. We will define a simple function that will get the name of the company and return the views of this company’s page.</p>
<ul class="simple">
<li><p>Generate the URL of the wikipedia page view using the name of the company</p></li>
<li><p>Load the API response from above URL</p></li>
<li><p>Parse the JSON format of the response using the key ‘items’</p></li>
<li><p>Return the newly create dataframe or an empty data frame if failed</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_views</span><span class="p">(</span><span class="n">company</span><span class="p">):</span>
    <span class="n">company_page_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;https://wikimedia.org/api/rest_v1/metrics/pageviews/per-article/en.wikipedia/all-access/all-agents/</span><span class="si">{</span><span class="n">company</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">/daily/2020090100/2020093000&#39;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">company_page_url</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">pd</span>
            <span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span>
                <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">(),</span> 
                <span class="s1">&#39;items&#39;</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can apply the function above on each of the row from the nasdaq 100 tickets list:</p>
<ul class="simple">
<li><p>Start with the first table from the nasdaq 100 list above</p></li>
<li><p>Group the ticker by the company name (in case we have multiple ticker to a company)</p></li>
<li><p>Apply the get view function on each of the company names and concat all the data frames together</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nasdaq_100_views</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">nasdaq_100_tickers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># .head(2)</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Company&#39;</span><span class="p">)[[</span><span class="s1">&#39;Company&#39;</span><span class="p">]]</span>
    <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_views</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nasdaq_100_views</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>project</th>
      <th>article</th>
      <th>granularity</th>
      <th>timestamp</th>
      <th>access</th>
      <th>agent</th>
      <th>views</th>
    </tr>
    <tr>
      <th>Company</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">ANSYS</th>
      <th>0</th>
      <td>en.wikipedia</td>
      <td>ANSYS</td>
      <td>daily</td>
      <td>2020090100</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>94.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>en.wikipedia</td>
      <td>ANSYS</td>
      <td>daily</td>
      <td>2020090200</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>62.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>en.wikipedia</td>
      <td>ANSYS</td>
      <td>daily</td>
      <td>2020090300</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>59.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>en.wikipedia</td>
      <td>ANSYS</td>
      <td>daily</td>
      <td>2020090400</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>47.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>en.wikipedia</td>
      <td>ANSYS</td>
      <td>daily</td>
      <td>2020090500</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>38.0</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">Zoom Video Communications</th>
      <th>25</th>
      <td>en.wikipedia</td>
      <td>Zoom_Video_Communications</td>
      <td>daily</td>
      <td>2020092600</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>9231.0</td>
    </tr>
    <tr>
      <th>26</th>
      <td>en.wikipedia</td>
      <td>Zoom_Video_Communications</td>
      <td>daily</td>
      <td>2020092700</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>9732.0</td>
    </tr>
    <tr>
      <th>27</th>
      <td>en.wikipedia</td>
      <td>Zoom_Video_Communications</td>
      <td>daily</td>
      <td>2020092800</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>13180.0</td>
    </tr>
    <tr>
      <th>28</th>
      <td>en.wikipedia</td>
      <td>Zoom_Video_Communications</td>
      <td>daily</td>
      <td>2020092900</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>14178.0</td>
    </tr>
    <tr>
      <th>29</th>
      <td>en.wikipedia</td>
      <td>Zoom_Video_Communications</td>
      <td>daily</td>
      <td>2020093000</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>13724.0</td>
    </tr>
  </tbody>
</table>
<p>2435 rows × 7 columns</p>
</div></div></div>
</div>
<p>We see that we have more than 2000 rows in the concatenated dataframe where each line is a view of a company in a specific day in the range of September 2020.</p>
<p>Let’s look on one of the companies (for example, <em>Lululemon Atheletica</em>)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nasdaq_100_views</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Lululemon Athletica&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>project</th>
      <th>article</th>
      <th>granularity</th>
      <th>timestamp</th>
      <th>access</th>
      <th>agent</th>
      <th>views</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020090100</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>1171.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020090200</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>1314.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020090300</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>985.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020090400</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>1018.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020090500</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>955.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020090600</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>939.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020090700</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>1007.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020090800</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>1246.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020090900</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>1534.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020091000</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>2010.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020091100</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>2046.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020091200</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>2565.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020091300</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>1940.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020091400</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>1359.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020091500</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>1332.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020091600</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>1228.0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020091700</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>1167.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020091800</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>1162.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020091900</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>1053.0</td>
    </tr>
    <tr>
      <th>19</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020092000</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>1138.0</td>
    </tr>
    <tr>
      <th>20</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020092100</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>1131.0</td>
    </tr>
    <tr>
      <th>21</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020092200</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>1183.0</td>
    </tr>
    <tr>
      <th>22</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020092300</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>1262.0</td>
    </tr>
    <tr>
      <th>23</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020092400</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>980.0</td>
    </tr>
    <tr>
      <th>24</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020092500</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>970.0</td>
    </tr>
    <tr>
      <th>25</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020092600</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>880.0</td>
    </tr>
    <tr>
      <th>26</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020092700</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>977.0</td>
    </tr>
    <tr>
      <th>27</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020092800</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>986.0</td>
    </tr>
    <tr>
      <th>28</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020092900</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>1035.0</td>
    </tr>
    <tr>
      <th>29</th>
      <td>en.wikipedia</td>
      <td>Lululemon_Athletica</td>
      <td>daily</td>
      <td>2020093000</td>
      <td>all-access</td>
      <td>all-agents</td>
      <td>1040.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Start with the page view table of all the nasdaq 100</p></li>
<li><p>Filter to include only the <em>Lululemon Athletica</em> views</p></li>
<li><p>Convert the timestamp column to date time format using the <em>%Y%m%d%H</em> format</p></li>
<li><p>Extract the day of the month from the above timestamp</p></li>
<li><p>Plot the results</p></li>
<li><p>as bar chart with the day of the month as x and the number of views as y</p></li>
<li><p>and title the graph as ‘Page views for …’ with the name of the focused company</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">focused_company</span> <span class="o">=</span> <span class="s1">&#39;Lululemon Athletica&#39;</span>
<span class="p">(</span>
    <span class="n">nasdaq_100_views</span>
    <span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">focused_company</span><span class="p">]</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">timestamp</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">))</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">day</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
    <span class="o">.</span><span class="n">plot</span>
    <span class="o">.</span><span class="n">bar</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;views&#39;</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Page views for </span><span class="si">{</span><span class="n">focused_company</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/01.03_loading_data_from_API_22_0.png" src="../_images/01.03_loading_data_from_API_22_0.png" />
</div>
</div>
</div>
<div class="section" id="loading-from-complex-api">
<h2>Loading from complex API<a class="headerlink" href="#loading-from-complex-api" title="Permalink to this headline">¶</a></h2>
<p>Many times API are more complex, nevertheless, we can still extract the relevant data.</p>
<p>Let’s get some stock data from <a class="reference external" href="https://www.alphavantage.co">alphavantage.co</a></p>
<p>This web service is providing useful investment information using an API, however, like many other API providers, it requires an API key to identify the request (and sometimes chanrge for it).</p>
<p>To allow secure execution of such API call, we will how to install a new python module and how to use it. The next cell is installing the module from <a class="reference external" href="https://ipython-secrets.readthedocs.io/en/latest/">ipython secrets</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">ipython</span><span class="o">-</span><span class="n">secrets</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: ipython-secrets in /Users/guy/miniconda3/lib/python3.8/site-packages (1.1.1)
Requirement already satisfied: ipython in /Users/guy/miniconda3/lib/python3.8/site-packages (from ipython-secrets) (7.18.1)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: keyring in /Users/guy/miniconda3/lib/python3.8/site-packages (from ipython-secrets) (21.8.0)
Requirement already satisfied: traitlets&gt;=4.2 in /Users/guy/miniconda3/lib/python3.8/site-packages (from ipython-&gt;ipython-secrets) (5.0.5)
Requirement already satisfied: pexpect&gt;4.3; sys_platform != &quot;win32&quot; in /Users/guy/miniconda3/lib/python3.8/site-packages (from ipython-&gt;ipython-secrets) (4.8.0)
Requirement already satisfied: pygments in /Users/guy/miniconda3/lib/python3.8/site-packages (from ipython-&gt;ipython-secrets) (2.7.1)
Requirement already satisfied: backcall in /Users/guy/miniconda3/lib/python3.8/site-packages (from ipython-&gt;ipython-secrets) (0.2.0)
Requirement already satisfied: decorator in /Users/guy/miniconda3/lib/python3.8/site-packages (from ipython-&gt;ipython-secrets) (4.4.2)
Requirement already satisfied: jedi&gt;=0.10 in /Users/guy/miniconda3/lib/python3.8/site-packages (from ipython-&gt;ipython-secrets) (0.17.2)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: prompt-toolkit!=3.0.0,!=3.0.1,&lt;3.1.0,&gt;=2.0.0 in /Users/guy/miniconda3/lib/python3.8/site-packages (from ipython-&gt;ipython-secrets) (3.0.8)
Requirement already satisfied: pickleshare in /Users/guy/miniconda3/lib/python3.8/site-packages (from ipython-&gt;ipython-secrets) (0.7.5)
Requirement already satisfied: appnope; sys_platform == &quot;darwin&quot; in /Users/guy/miniconda3/lib/python3.8/site-packages (from ipython-&gt;ipython-secrets) (0.1.0)
Requirement already satisfied: setuptools&gt;=18.5 in /Users/guy/miniconda3/lib/python3.8/site-packages (from ipython-&gt;ipython-secrets) (46.4.0.post20200518)
Requirement already satisfied: ipython-genutils in /Users/guy/miniconda3/lib/python3.8/site-packages (from traitlets&gt;=4.2-&gt;ipython-&gt;ipython-secrets) (0.2.0)
Requirement already satisfied: ptyprocess&gt;=0.5 in /Users/guy/miniconda3/lib/python3.8/site-packages (from pexpect&gt;4.3; sys_platform != &quot;win32&quot;-&gt;ipython-&gt;ipython-secrets) (0.6.0)
Requirement already satisfied: parso&lt;0.8.0,&gt;=0.7.0 in /Users/guy/miniconda3/lib/python3.8/site-packages (from jedi&gt;=0.10-&gt;ipython-&gt;ipython-secrets) (0.7.1)
Requirement already satisfied: wcwidth in /Users/guy/miniconda3/lib/python3.8/site-packages (from prompt-toolkit!=3.0.0,!=3.0.1,&lt;3.1.0,&gt;=2.0.0-&gt;ipython-&gt;ipython-secrets) (0.2.5)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Note: you may need to restart the kernel to use updated packages.
</pre></div>
</div>
</div>
</div>
<p>Once we have the module to handle secrets installed, we can import it to the notebook and use it. The module will pop up the request for the user to enter the API key, which you can get from <a class="reference external" href="https://www.alphavantage.co/support/#api-key">alphavantage.co</a>. Next time you will execute the cell and the whole notebook, the API key will be retrieved from the keyring of the machine running the notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ipython_secrets</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">ALPHAVANTAGE_API_KEY</span> <span class="o">=</span> <span class="n">get_secret</span><span class="p">(</span><span class="s1">&#39;ALPHAVANTAGE_API_KEY&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>From the <a class="reference external" href="https://www.alphavantage.co/documentation/">API documentation</a> we can learn how to extract time-series stock information of a specific symbol. Let’s use Amazon (AMZN) for example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">symbol</span> <span class="o">=</span> <span class="s1">&#39;AMZN&#39;</span>

<span class="n">request_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&amp;symbol=</span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s1">&amp;interval=1min&amp;apikey=</span><span class="si">{</span><span class="n">ALPHAVANTAGE_API_KEY</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span>
    <span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">request_url</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Meta Data</th>
      <th>Time Series (1min)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1. Information</th>
      <td>Intraday (1min) open, high, low, close prices ...</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2. Symbol</th>
      <td>AMZN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3. Last Refreshed</th>
      <td>2021-01-15 19:49:00</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4. Interval</th>
      <td>1min</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5. Output Size</th>
      <td>Compact</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2021-01-15 15:07:00</th>
      <td>NaN</td>
      <td>{'1. open': '3101.0000', '2. high': '3102.3600...</td>
    </tr>
    <tr>
      <th>2021-01-15 15:06:00</th>
      <td>NaN</td>
      <td>{'1. open': '3103.5000', '2. high': '3103.5000...</td>
    </tr>
    <tr>
      <th>2021-01-15 15:05:00</th>
      <td>NaN</td>
      <td>{'1. open': '3104.1100', '2. high': '3104.1800...</td>
    </tr>
    <tr>
      <th>2021-01-15 15:04:00</th>
      <td>NaN</td>
      <td>{'1. open': '3105.9900', '2. high': '3106.1300...</td>
    </tr>
    <tr>
      <th>2021-01-15 15:03:00</th>
      <td>NaN</td>
      <td>{'1. open': '3104.1713', '2. high': '3105.6600...</td>
    </tr>
  </tbody>
</table>
<p>106 rows × 2 columns</p>
</div></div></div>
</div>
</div>
<div class="section" id="extracting-the-relevant-data">
<h2>Extracting the relevant data<a class="headerlink" href="#extracting-the-relevant-data" title="Permalink to this headline">¶</a></h2>
<p>We see that the data that we are looking for (open, close, high and low prices and volume in each minute) is available in a column of the dataframe table. We will filter the table to include only the rows with the prices data and split it to separated columns.</p>
<ul class="simple">
<li><p>Start with the dataframe table that was returned from the API call</p></li>
<li><p>Rename the long ‘Time Series…’ column name to short ‘ts’</p></li>
<li><p>Filter out all the rows where ‘ts’ column has no value (<em>null</em>)</p></li>
<li><p>Take only the ‘ts’ column for all the row left</p></li>
<li><p>Parse each value in the column as a series of key-value pairs and create a column for each pair</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">json_series</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df</span>
    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Time Series (1min)&#39;</span><span class="p">:</span><span class="s1">&#39;ts&#39;</span><span class="p">})</span>
    <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;ts.notnull()&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">json_series</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1. open</th>
      <th>2. high</th>
      <th>3. low</th>
      <th>4. close</th>
      <th>5. volume</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2021-01-15 19:49:00</th>
      <td>3099.0000</td>
      <td>3099.0000</td>
      <td>3099.0000</td>
      <td>3099.0000</td>
      <td>146</td>
    </tr>
    <tr>
      <th>2021-01-15 19:38:00</th>
      <td>3098.1200</td>
      <td>3098.1200</td>
      <td>3098.1200</td>
      <td>3098.1200</td>
      <td>114</td>
    </tr>
    <tr>
      <th>2021-01-15 19:24:00</th>
      <td>3099.0000</td>
      <td>3099.0000</td>
      <td>3099.0000</td>
      <td>3099.0000</td>
      <td>484</td>
    </tr>
    <tr>
      <th>2021-01-15 19:17:00</th>
      <td>3098.0000</td>
      <td>3098.0000</td>
      <td>3098.0000</td>
      <td>3098.0000</td>
      <td>295</td>
    </tr>
    <tr>
      <th>2021-01-15 18:50:00</th>
      <td>3098.3300</td>
      <td>3098.3300</td>
      <td>3098.0000</td>
      <td>3098.0000</td>
      <td>412</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2021-01-15 15:07:00</th>
      <td>3101.0000</td>
      <td>3102.3600</td>
      <td>3101.0000</td>
      <td>3101.2300</td>
      <td>8288</td>
    </tr>
    <tr>
      <th>2021-01-15 15:06:00</th>
      <td>3103.5000</td>
      <td>3103.5000</td>
      <td>3100.5400</td>
      <td>3101.2700</td>
      <td>11412</td>
    </tr>
    <tr>
      <th>2021-01-15 15:05:00</th>
      <td>3104.1100</td>
      <td>3104.1800</td>
      <td>3102.6200</td>
      <td>3103.2543</td>
      <td>7850</td>
    </tr>
    <tr>
      <th>2021-01-15 15:04:00</th>
      <td>3105.9900</td>
      <td>3106.1300</td>
      <td>3104.3000</td>
      <td>3104.3000</td>
      <td>6382</td>
    </tr>
    <tr>
      <th>2021-01-15 15:03:00</th>
      <td>3104.1713</td>
      <td>3105.6600</td>
      <td>3104.0700</td>
      <td>3105.6600</td>
      <td>7150</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 5 columns</p>
</div></div></div>
</div>
</div>
<div class="section" id="quick-visualization">
<h2>Quick Visualization<a class="headerlink" href="#quick-visualization" title="Permalink to this headline">¶</a></h2>
<p>Now that we have the prices from the API we can plot them.</p>
<ul class="simple">
<li><p>Start with the parsed data table above</p></li>
<li><p>Convert the values to numeric form (<em>astype(‘float’)</em>)</p></li>
<li><p>Slice the table to include only the <em>high</em> and <em>low</em> values (<em>iloc</em>)</p></li>
<li><p>Reverse the order of the time-series to be from oldest to newest (<em>iloc[::-1]</em>)</p></li>
<li><p>Plot the data</p></li>
<li><p>with the title of the ticker</p></li>
<li><p>and with 45° rotation.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">json_series</span>
    <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">loc</span><span class="p">[:,(</span><span class="s1">&#39;2. high&#39;</span><span class="p">,</span><span class="s1">&#39;3. low&#39;</span><span class="p">)]</span>
    <span class="o">.</span><span class="n">iloc</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span> 
        <span class="n">rot</span><span class="o">=</span><span class="mi">45</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/01.03_loading_data_from_API_37_0.png" src="../_images/01.03_loading_data_from_API_37_0.png" />
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="01.02%20-%20loading%20data%20from%20HTML.html" title="previous page">Reading Data from Web Sites</a>
    <a class='right-next' id="next-link" href="02.01_Adding_New_Columns.html" title="next page">Adding New Columns</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The Aiola Team<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
  </body>
</html>